!function(k){var C,i,o,e=k("body"),c={base:{fontSize:"16px",color:"#333"}},t=yith_stripe_connect_info.account_id?{stripeAccount:yith_stripe_connect_info.account_id}:{},S=Stripe(yith_stripe_connect_info.public_key,t),a=S.elements();function n(){var e,t=k("#yith-stripe-connect-card-number"),n=k("#yith-stripe-connect-card-expiry"),r=k("#yith-stripe-connect-card-cvc");t.length&&(e=t.attr("placeholder"),void 0!==C&&C.destroy(),C=a.create("cardNumber",{style:c,placeholder:e}),t.replaceWith('<div id="yith-stripe-card-number" class="yith-stripe-elements-field">'),C.mount("#yith-stripe-card-number")),n.length&&(e=n.attr("placeholder"),void 0!==i&&i.destroy(),i=a.create("cardExpiry",{style:c,placeholder:e}),n.replaceWith('<div id="yith-stripe-card-expiry" class="yith-stripe-elements-field">'),i.mount("#yith-stripe-card-expiry")),r.length&&(e=r.attr("placeholder"),void 0!==o&&o.destroy(),o=a.create("cardCvc",{style:c,placeholder:e}),r.replaceWith('<div id="yith-stripe-card-cvc" class="yith-stripe-elements-field">'),o.mount("#yith-stripe-card-cvc"))}function r(e){if(k("input#payment_method_yith-stripe-connect").is(":checked")&&0===k("input.stripe-connect-intent").length){var t,n=k("form.checkout, form#order_review, form#add_payment_method"),r=k("#wc-yith-stripe-connect-cc-form, #yith-stripe-connect-cc-form"),i=k(".woocommerce-checkout-payment, .woocommerce-checkout-review-order-table, #add_payment_method"),o=k(".wc-credit-card-form-card-name"),c=o.length?o.val():k("#billing_first_name").val()+" "+k("#billing_last_name").val(),a=k("#billing_email").val(),l=k("#billing_country"),s=l.val(),d=k("#billing_city:visible"),p=d.val(),h=k("#billing_address_1:visible"),m=h.val(),_=k("#billing_address_2:visible").val(),u=k("select#billing_state, input#billing_state:visible"),f=u.val(),y=k("#billing_postcode:visible"),v=y.val(),g=!(!(g=k('input[name="wc-yith-stripe-connect-payment-token"]:checked')).length||"new"===g.val())&&g.val();i.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var b=!1,w=[];return(l.closest("p.form-row.validate-required").length&&l.length&&""===s||d.closest("p.form-row.validate-required").length&&d.length&&""===p||h.closest("p.form-row.validate-required").length&&h.length&&""===m||u.closest("p.form-row.validate-required").length&&u.length&&""===f||y.closest("p.form-row.validate-required").length&&y.length&&""===v)&&(b=!0,w.push("billing.fields"),""===s&&l.parents("p.form-row").addClass("error"),""===p&&d.parents("p.form-row").addClass("error"),""===m&&h.parents("p.form-row").addClass("error"),""===f&&u.parents("p.form-row").addClass("error"),""===v&&y.parents("p.form-row").addClass("error")),b?(x({error:{code:"validation",fieldErrors:w}}),k("fieldset#wc-yith-stripe-connect-cc-form input, fieldset#wc-yith-stripe-connect-cc-form select, fieldset#yith-stripe-connect-cc-form input, fieldset#yith-stripe-connect-cc-form select").one("keydown",function(){k(this).closest("p.form-row.error").removeClass("error")}),k(document).trigger("yith-stripe-connect-card-error")):g?(r.append('<input type="hidden" class="stripe-connect-intent" name="stripe_connect_intent" value=""/>'),i.unblock(),n.submit()):(t=j({billing_details:{name:c,address:{line1:m,line2:_,city:p,state:f,country:s,postal_code:v},email:a}}),S.createPaymentMethod("card",C,t).then(function(e){e.error?x(e):(r.append('<input type="hidden" class="stripe-connect-intent" name="stripe_connect_intent" value=""/>'),r.append('<input type="hidden" class="stripe-connect-payment-method" name="stripe_connect_payment_method" value="'+e.paymentMethod.id+'"/>'),i.unblock(),n.submit())})),!1}return e}function l(e){if(k("input#payment_method_yith-stripe-connect").is(":checked")&&0===k("input.stripe-connect-intent").length){var t,n,r=k("#wc-yith-stripe-connect-cc-form, #yith-stripe-connect-cc-form"),i=k("form#add_payment_method"),o=k("#add_payment_method"),c=k(".wc-credit-card-form-card-name"),a=k("#billing_email"),l=k("#billing_country"),s=k("#billing_city:visible"),d=k("#billing_address_1:visible"),p=k("#billing_address_2:visible"),h=k("select#billing_state:visible, input#billing_state:visible"),m=k("#billing_postcode:visible"),_=j({payment_method_data:{billing_details:{name:c.length?c.val():k("#billing_first_name").val()+" "+k("#billing_last_name").val(),address:{line1:d.length?d.val():"",line2:p.length?p.val():"",city:s.length?s.val():"",state:h.length?h.val():"",country:l.length?l.val():"",postal_code:m.length?m.val():""},email:a.length?a.val():""}},save_payment_method:!0});return o.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),function(e){var t=[];yith_stripe_connect_info.is_checkout&&!yith_stripe_connect_info.order&&(t=k("form.checkout").serializeArray());return k.ajax({data:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&e.push({name:n,value:t[n]});return e}(t,{action:"yith_stripe_connect_refresh_intent",yith_stripe_connect_refresh_intent:yith_stripe_connect_info.refresh_intent,selected_token:e,is_checkout:yith_stripe_connect_info.is_checkout,order:yith_stripe_connect_info.order}),method:"POST",url:yith_stripe_connect_info.ajaxurl})}().then(function(e){return void 0===e.res||e.res||void 0===e.error?(t=e.intent_id,n=e.intent_secret,void S.handleCardSetup(n,C,_).then(function(e){e.error?x(e):(t=void 0!==e.paymentIntent?e.paymentIntent.id:e.setupIntent.id,r.append('<input type="hidden" class="stripe-connect-intent" name="stripe_connect_intent" value="'+t+'"/>'),o.unblock(),i.submit())})):(x(e),!1)}),!1}return e}function s(){var e,t,n=window.location.hash.match(/^#?yith-stripe-connect-confirm-pi-([^:]+):(.+)$/);!n||n.length<3||(e=n[1],t=decodeURIComponent(n[2]),window.location.hash="",function(e,t){k("form.checkout, form#order_review");var n=e.indexOf("seti")<0?"handleCardAction":"handleCardSetup";S[n](e).then(function(e){e.error?x(e):window.location=t}).catch(function(e){console.log(e)})}(e,t))}function x(e){var t=k("form.checkout, form#order_review, form#add_payment_method"),n=k("#wc-yith-stripe-connect-cc-form, #yith-stripe-connect-cc-form"),r=k(".woocommerce-checkout-payment, .woocommerce-checkout-review-order-table, #add_payment_method");if(e.error){if(k(".woocommerce-error, .stripe-token",n).remove(),e.error.message)n.prepend('<ul class="woocommerce-error">'+e.error.message+"</ul>");else if("validation"===e.error.code){for(var i=e.error.fieldErrors,o=i.length,c="",a=0;a<o;a++)c+="<li>"+yith_stripe_connect_info[i[a]]+"</li>";n.prepend('<ul class="woocommerce-error">'+c+"</ul>")}k("html, body").animate({scrollTop:k(".woocommerce-error",n).offset().top})}t.removeClass("processing").unblock(),r.unblock()}function d(){k(".stripe-connect-intent").remove()}function j(e){var t,n,r={};if("object"!=typeof e)return e;for(t in e)e.hasOwnProperty(t)&&(n="object"==typeof e[t]?j(e[t]):e[t])&&!k.isEmptyObject(n)&&(r[t]=n);return r}k(function(){n(),void 0!==C&&C.addEventListener("change",x),k("form.checkout").on("checkout_place_order_yith-stripe-connect",r),k("form#order_review").on("submit",r),k("form#add_payment_method").on("submit",l),window.addEventListener("hashchange",s),e.on("checkout_error",d),e.on("updated_checkout",n),k("form.checkout, form#order_review, form#add_payment_method").on("change","#wc-yith-stripe-connect-cc-form input, #yith-stripe-connect-cc-form input",d)})}(jQuery);